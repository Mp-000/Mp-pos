<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>POS Enterprise Lengkap</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-light">

<div class="container mt-3">
  <div class="card shadow">
    <div class="card-header bg-dark text-white">POS Enterprise – Cash | Transfer | Cicilan</div>
    <div class="card-body">

      <div class="row g-2">
        <div class="col-md-4"><input id="invoice" class="form-control" readonly></div>
        <div class="col-md-4"><input id="customer" class="form-control" placeholder="Nama Pelanggan"></div>
        <div class="col-md-4">
          <select id="metode" class="form-select" onchange="ubahMetode()">
            <option value="">Metode Pembayaran</option>
            <option value="Cash">Cash</option>
            <option value="Transfer">Transfer</option>
            <option value="Cicilan">Cicilan</option>
          </select>
        </div>
      </div>

      <div class="row g-2 mt-2">
        <div class="col-md-4"><input id="total" type="number" class="form-control" placeholder="Total Transaksi"></div>
        <div class="col-md-4 d-none" id="cashBox"><input id="bayar" type="number" class="form-control" placeholder="Bayar Cash"></div>
        <div class="col-md-4 d-none" id="tfBox"><input id="bukti" class="form-control" placeholder="No Referensi Transfer"></div>
        <div class="col-md-4 d-none" id="cicilBox">
          <select id="tenor" class="form-select" onchange="hitungCicilan()">
            <option value="">Tenor Cicilan</option>
            <option value="1">1 Bulan – 4.90%</option>
            <option value="3">3 Bulan – 4.70%</option>
            <option value="6">6 Bulan – 4.50%</option>
            <option value="12">12 Bulan – 4.05%</option>
            <option value="24">24 Bulan – 3.75%</option>
          </select>
        </div>
      </div>

      <div class="mt-3 d-none" id="rincian">
        <p>Admin Fee (25%): <b id="admin"></b></p>
        <p>Total Kredit: <b id="grand"></b></p>
        <p>Cicilan / Bulan: <b id="perbulan"></b></p>
      </div>

      <button class="btn btn-success w-100 mt-3" onclick="simpan()">Simpan Transaksi</button>
    </div>
  </div>

  <div class="card shadow mt-3">
    <div class="card-header bg-primary text-white">Laporan Piutang</div>
    <div class="card-body">
      <table class="table table-bordered table-sm">
        <thead>
          <tr>
            <th>Invoice</th>
            <th>Pelanggan</th>
            <th>Metode</th>
            <th>Total</th>
            <th>Status</th>
            <th>Sisa</th>
          </tr>
        </thead>
        <tbody id="table"></tbody>
      </table>
    </div>
  </div>

</div>

<script>
let transaksi = JSON.parse(localStorage.getItem('transaksi')) || [];
const bunga = {1:4.9,3:4.7,6:4.5,12:4.05,24:3.75};

invoice.value = 'INV-' + Date.now();

function ubahMetode(){
  cashBox.classList.add('d-none');
  tfBox.classList.add('d-none');
  cicilBox.classList.add('d-none');
  rincian.classList.add('d-none');

  if(metode.value==='Cash') cashBox.classList.remove('d-none');
  if(metode.value==='Transfer') tfBox.classList.remove('d-none');
  if(metode.value==='Cicilan') cicilBox.classList.remove('d-none');
}

function hitungCicilan(){
  const t = +total.value;
  const n = +tenor.value;
  const adminFee = t*0.25;
  const bungaTotal = t*(bunga[n]/100)*n;
  const grandTotal = t + adminFee + bungaTotal;
  const per = Math.round(grandTotal/n);

  admin.innerText='Rp '+adminFee.toLocaleString();
  grand.innerText='Rp '+grandTotal.toLocaleString();
  perbulan.innerText='Rp '+per.toLocaleString();
  rincian.classList.remove('d-none');

  return {grandTotal, per};
}

function simpan(){
  if(!metode.value || !total.value){
    Swal.fire('Error','Lengkapi data','error'); return;
  }

  let status='Lunas', sisa=0;

  if(metode.value==='Cicilan'){
    const h = hitungCicilan();
    status='Belum Lunas';
    sisa=h.grandTotal;
  }

  transaksi.push({
    invoice:invoice.value,
    customer:customer.value,
    metode:metode.value,
    total:+total.value,
    status:status,
    sisa:sisa
  });

  localStorage.setItem('transaksi', JSON.stringify(transaksi));
  Swal.fire('Berhasil','Transaksi disimpan','success');
  render();
}

function render(){
  table.innerHTML='';
  transaksi.forEach(t=>{
    table.innerHTML+=`
      <tr>
        <td>${t.invoice}</td>
        <td>${t.customer||'-'}</td>
        <td>${t.metode}</td>
        <td>Rp ${t.total}</td>
        <td>${t.status}</td>
        <td>Rp ${t.sisa||0}</td>
      </tr>`;
  });
}

render();
</script>
</body>
                                             </html>
  
