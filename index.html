<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Sistem Informasi Jasa & Produk</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">

<div class="container mt-4">
  <h2 class="text-center">ðŸ’¼ Sistem Informasi Jasa & Produk</h2>
  <hr>

  <!-- Form Produk -->
  <div class="card mb-3">
    <div class="card-header">Tambah Produk</div>
    <div class="card-body">
      <form id="formProduk">
        <div class="row">
          <div class="col-md-4">
            <input type="text" id="namaProduk" class="form-control" placeholder="Nama Produk" required>
          </div>
          <div class="col-md-3">
            <input type="number" id="hargaProduk" class="form-control" placeholder="Harga" required>
          </div>
          <div class="col-md-3">
            <input type="text" id="kategoriProduk" class="form-control" placeholder="Kategori" required>
          </div>
          <div class="col-md-2">
            <button class="btn btn-primary w-100">Tambah</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Daftar Produk -->
  <div class="card mb-3">
    <div class="card-header">Daftar Produk</div>
    <div class="card-body">
      <table class="table table-bordered" id="tabelProduk">
        <thead>
          <tr>
            <th>Nama</th>
            <th>Harga</th>
            <th>Kategori</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- Checkout -->
  <div class="card mb-3">
    <div class="card-header">Checkout</div>
    <div class="card-body">
      <button class="btn btn-success" onclick="checkout()">Checkout</button>
    </div>
  </div>

  <!-- Laporan -->
  <div class="card mb-3">
    <div class="card-header">Laporan Penjualan</div>
    <div class="card-body">
      <canvas id="laporanChart"></canvas>
    </div>
  </div>
</div>

<script>
  let produkList = JSON.parse(localStorage.getItem("produkList")) || [];
  let transaksiList = JSON.parse(localStorage.getItem("transaksiList")) || [];

  // Render Produk
  function renderProduk() {
    const tbody = document.querySelector("#tabelProduk tbody");
    tbody.innerHTML = "";
    produkList.forEach((p, i) => {
      tbody.innerHTML += `
        <tr>
          <td>${p.nama}</td>
          <td>Rp ${p.harga}</td>
          <td>${p.kategori}</td>
          <td><button class="btn btn-sm btn-danger" onclick="hapusProduk(${i})">Hapus</button></td>
        </tr>
      `;
    });
  }

  // Tambah Produk
  document.getElementById("formProduk").addEventListener("submit", e => {
    e.preventDefault();
    const nama = document.getElementById("namaProduk").value;
    const harga = parseFloat(document.getElementById("hargaProduk").value);
    const kategori = document.getElementById("kategoriProduk").value;

    produkList.push({nama, harga, kategori});
    localStorage.setItem("produkList", JSON.stringify(produkList));
    renderProduk();
    Swal.fire("Berhasil!", "Produk ditambahkan", "success");
    e.target.reset();
  });

  // Hapus Produk
  function hapusProduk(i) {
    produkList.splice(i,1);
    localStorage.setItem("produkList", JSON.stringify(produkList));
    renderProduk();
  }

  // Checkout
  function checkout() {
    if(produkList.length === 0) {
      Swal.fire("Oops!", "Tidak ada produk untuk checkout", "error");
      return;
    }

    Swal.fire({
      title: "Pilih Metode Pembayaran",
      input: "select",
      inputOptions: {
        "Tunai": "Tunai",
        "QRIS": "QRIS",
        "Cicilan": "Cicilan"
      },
      inputPlaceholder: "Pilih metode",
      showCancelButton: true
    }).then(result => {
      if(result.isConfirmed) {
        let metode = result.value;
        let total = produkList.reduce((sum,p)=>sum+p.harga,0);

        if(metode === "Cicilan") {
          Swal.fire({
            title: "Pilih Tenor Cicilan",
            input: "select",
            inputOptions: {
              "1": "1 bulan (4.90%)",
              "2": "2 bulan (4.80%)",
              "3": "3 bulan (4.70%)",
              "6": "6 bulan (4.55%)",
              "9": "9 bulan (4.30%)",
              "12": "12 bulan (4.10%)",
              "18": "18 bulan (4.00%)",
              "24": "24 bulan (3.70%)"
            }
          }).then(r2=>{
            if(r2.isConfirmed){
              let tenor = parseInt(r2.value);
              let bunga = {1:4.90,2:4.80,3:4.70,6:4.55,9:4.30,12:4.10,18:4.00,24:3.70}[tenor];
              let totalBunga = total + (total*bunga/100);
              let cicilan = (totalBunga/tenor).toFixed(2);

              transaksiList.push({tanggal:new Date().toLocaleDateString(), total, metode, tenor, cicilan});
              localStorage.setItem("transaksiList", JSON.stringify(transaksiList));

              Swal.fire("Berhasil!", `Total Rp ${totalBunga} dibayar ${tenor}x cicilan Rp ${cicilan}`, "success");
              updateChart();
            }
          });
        } else {
          transaksiList.push({tanggal:new Date().toLocaleDateString(), total, metode});
          localStorage.setItem("transaksiList", JSON.stringify(transaksiList));
          Swal.fire("Berhasil!", `Total Rp ${total} dibayar dengan ${metode}`, "success");
          updateChart();
        }
      }
    });
  }

  // Chart Laporan
  function updateChart() {
    let ctx = document.getElementById("laporanChart");
    let labels = transaksiList.map(t=>t.tanggal);
    let data = transaksiList.map(t=>t.total);

    new Chart(ctx, {
      type: "bar",
      data: {
        labels: labels,
        datasets: [{
          label: "Total Penjualan",
          data: data,
          backgroundColor: "rgba(75,192,192,0.6)"
        }]
      }
    });
  }

  renderProduk();
  updateChart();
</script>
</body>
</html>
