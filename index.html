<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>POS Profesional Lengkap</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-dark">
  <div class="container-fluid">
    <span class="navbar-brand fw-bold">POS PROFESIONAL LENGKAP</span>
    <span class="text-white">Offline Ready</span>
  </div>
</nav>

<div class="container-fluid mt-3">
  <div class="row">

    <!-- SIDEBAR -->
    <div class="col-md-2">
      <div class="list-group">
        <button class="list-group-item" onclick="show('dashboard')">Dashboard</button>
        <button class="list-group-item" onclick="show('produk')">Produk</button>
        <button class="list-group-item" onclick="show('pelanggan')">Pelanggan</button>
        <button class="list-group-item" onclick="show('supplier')">Supplier</button>
        <button class="list-group-item" onclick="show('transaksi')">Transaksi</button>
        <button class="list-group-item" onclick="show('cicilan')">Cicilan</button>
        <button class="list-group-item" onclick="show('laporan')">Laporan</button>
      </div>
    </div>

    <!-- CONTENT -->
    <div class="col-md-10">

      <!-- DASHBOARD -->
      <div id="dashboard" class="box">
        <h4>Dashboard</h4>
        <div class="row">
          <div class="col"><div class="card p-3">Omzet: Rp <span id="omzet">0</span></div></div>
          <div class="col"><div class="card p-3">Transaksi: <span id="trxCount">0</span></div></div>
          <div class="col"><div class="card p-3">Hutang: Rp <span id="hutang">0</span></div></div>
        </div>
      </div>

      <!-- PRODUK -->
      <div id="produk" class="box d-none">
        <h4>Master Produk</h4>
        <input id="pNama" class="form-control mb-2" placeholder="Nama Produk">
        <input id="pHarga" type="number" class="form-control mb-2" placeholder="Harga">
        <input id="pStok" type="number" class="form-control mb-2" placeholder="Stok">
        <button class="btn btn-success" onclick="addProduk()">Simpan</button>
        <table class="table table-bordered mt-3"><thead><tr><th>Nama</th><th>Harga</th><th>Stok</th></tr></thead><tbody id="listProduk"></tbody></table>
      </div>

      <!-- PELANGGAN -->
      <div id="pelanggan" class="box d-none">
        <h4>Master Pelanggan</h4>
        <input id="cNama" class="form-control mb-2" placeholder="Nama Pelanggan">
        <input id="cHp" class="form-control mb-2" placeholder="No HP">
        <button class="btn btn-success" onclick="addCustomer()">Simpan</button>
        <table class="table table-bordered mt-3"><thead><tr><th>Nama</th><th>No HP</th></tr></thead><tbody id="listCustomer"></tbody></table>
      </div>

      <!-- SUPPLIER -->
      <div id="supplier" class="box d-none">
        <h4>Master Supplier</h4>
        <input id="sNama" class="form-control mb-2" placeholder="Nama Supplier">
        <input id="sHp" class="form-control mb-2" placeholder="No HP">
        <button class="btn btn-success" onclick="addSupplier()">Simpan</button>
        <table class="table table-bordered mt-3"><thead><tr><th>Nama</th><th>No HP</th></tr></thead><tbody id="listSupplier"></tbody></table>
      </div>

      <!-- TRANSAKSI -->
      <div id="transaksi" class="box d-none">
        <h4>Transaksi POS</h4>
        <select id="produkSelect" class="form-select mb-2"></select>
        <input id="qty" type="number" class="form-control mb-2" placeholder="Qty">
        <select id="metode" class="form-select mb-2">
          <option value="cash">Cash</option>
          <option value="kredit">Kredit</option>
        </select>
        <div id="kreditBox" class="mb-2 d-none">
          <input id="dp" type="number" class="form-control" placeholder="Uang Muka">
        </div>
        <button class="btn btn-primary" onclick="addCart()">Tambah</button>
        <table class="table table-bordered mt-3"><thead><tr><th>Produk</th><th>Qty</th><th>Subtotal</th></tr></thead><tbody id="cart"></tbody></table>
        <h5>Total: Rp <span id="total">0</span></h5>
        <button class="btn btn-danger" onclick="bayar()">Proses & Cetak Invoice</button>
      </div>

      <!-- CICILAN -->
      <div id="cicilan" class="box d-none">
        <h4>Data Cicilan</h4>
        <table class="table table-bordered"><thead><tr><th>Tanggal</th><th>Total</th><th>DP</th><th>Sisa</th><th>Status</th></tr></thead><tbody id="listCicilan"></tbody></table>
      </div>

      <!-- LAPORAN -->
      <div id="laporan" class="box d-none">
        <h4>Laporan Penjualan</h4>
        <canvas id="chart"></canvas>
      </div>

    </div>
  </div>
</div>

<script>
let produk=JSON.parse(localStorage.getItem('produk'))||[];
let customer=JSON.parse(localStorage.getItem('customer'))||[];
let supplier=JSON.parse(localStorage.getItem('supplier'))||[];
let transaksi=JSON.parse(localStorage.getItem('transaksi'))||[];
let cicilan=JSON.parse(localStorage.getItem('cicilan'))||[];
let cartData=[];

metode.onchange=()=>kreditBox.classList.toggle('d-none',metode.value!=='kredit');

function show(id){document.querySelectorAll('.box').forEach(b=>b.classList.add('d-none'));document.getElementById(id).classList.remove('d-none');}

function addProduk(){produk.push({nama:pNama.value,harga:+pHarga.value,stok:+pStok.value});save();render();}
function addCustomer(){customer.push({nama:cNama.value,hp:cHp.value});save();render();}
function addSupplier(){supplier.push({nama:sNama.value,hp:sHp.value});save();render();}

function addCart(){let p=produk[produkSelect.value];let q=+qty.value;if(q>p.stok)return;cartData.push({nama:p.nama,qty:q,sub:p.harga*q});render();}

function bayar(){
  let total=cartData.reduce((a,b)=>a+b.sub,0);
  let tgl=new Date().toLocaleDateString();
  if(metode.value==='kredit'){
    let sisa=total-+dp.value;
    cicilan.push({tgl,total,dp:+dp.value,sisa,status:'Belum Lunas'});
  }
  transaksi.push({tgl,total});
  Swal.fire('Invoice','Total Rp '+total,'success');
  cartData=[];save();render();updateDashboard();}

function render(){
  listProduk.innerHTML=produk.map(p=>`<tr><td>${p.nama}</td><td>${p.harga}</td><td>${p.stok}</td></tr>`).join('');
  listCustomer.innerHTML=customer.map(c=>`<tr><td>${c.nama}</td><td>${c.hp}</td></tr>`).join('');
  listSupplier.innerHTML=supplier.map(s=>`<tr><td>${s.nama}</td><td>${s.hp}</td></tr>`).join('');
  produkSelect.innerHTML=produk.map((p,i)=>`<option value='${i}'>${p.nama}</option>`).join('');
  cart.innerHTML=cartData.map(c=>`<tr><td>${c.nama}</td><td>${c.qty}</td><td>${c.sub}</td></tr>`).join('');
  total.innerText=cartData.reduce((a,b)=>a+b.sub,0);
  listCicilan.innerHTML=cicilan.map(c=>`<tr><td>${c.tgl}</td><td>${c.total}</td><td>${c.dp}</td><td>${c.sisa}</td><td>${c.status}</td></tr>`).join('');
}

function updateDashboard(){
  omzet.innerText=transaksi.reduce((a,b)=>a+b.total,0);
  trxCount.innerText=transaksi.length;
  hutang.innerText=cicilan.reduce((a,b)=>a+b.sisa,0);
}

function save(){localStorage.setItem('produk',JSON.stringify(produk));localStorage.setItem('customer',JSON.stringify(customer));localStorage.setItem('supplier',JSON.stringify(supplier));localStorage.setItem('transaksi',JSON.stringify(transaksi));localStorage.setItem('cicilan',JSON.stringify(cicilan));}

render();updateDashboard();
new Chart(document.getElementById('chart'),{type:'bar',data:{labels:transaksi.map(t=>t.tgl),datasets:[{data:transaksi.map(t=>t.total)}]}});
</script>

</body>
  </html>
